<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>BlueNRG-LP/BlueNRG-LPS network coprocessor (UART mode): NUCLEO-L476RG - BlueNRG-LP/BlueNRG-LPS UART network co-processor</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="STcustom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ST-logo-small.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BlueNRG-LP/BlueNRG-LPS network coprocessor (UART mode)
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">NUCLEO-L476RG - BlueNRG-LP/BlueNRG-LPS UART network co-processor </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document describes an example of the BlueNRG-LP/BlueNRG-LPS network co-processor UART protocol implementation on a STM32L4 microcontroller (NUCLEO-L476RG platform).<br />
 The document content is valid for BlueNRG-LP/BlueNRG-LPS devices.<br />
 The BlueNRG-LP/BlueNRG-LPS device is configured as a network co-processor (UART mode).</p>
<h1><a class="anchor" id="U1"></a>
Hardware Platforms</h1>
<ul>
<li>BlueNRG-LP development platform (STEVAL-IDB011V1 (NRND), STEVAL-IDB011V2) </li>
<li>BlueNRG-LPS development platforms (STEVAL-IDB012V1) </li>
<li>STM32L476RG Nucleo platform (order code: NUCLEO-L476RG)</li>
</ul>
<ul>
<li>NOTES: <ol>
<li>
When using a NUCLEO-L476RG platform, install the related ST-Link, ST-Link/V2, ST-Link/V2-1 USB driver signed for XP, Windows7, Windows8, Windows 10 (STSW-LINK009) </li>
<li>
When using a NUCLEO-L476RG platform, make sure the ST-Link firmware is updated to latest version available on ST web page. This can be checked/achieved by using the STM32 ST-LINK Utility v4.2.0 (or later). </li>
</ol>
</li>
</ul>
<h1><a class="anchor" id="U2"></a>
Hardware Platforms Prerequisites: connections and HW modifications</h1>
<ul>
<li>The following connections must be performed between the 2 platforms (Nucleo-L476RG &amp; BlueNRG-LP/BlueNRG-LPS development platforms ):</li>
</ul>
<table  border="1">
<tr>
<th>Pin Function MCU side </th><th>Nucleo pin/connector (UART1) </th><th>BlueNRG-LP/LPS development platforms pin/connector  </th></tr>
<tr>
<td><b> UART TX </b></td><td>PA9/CN10.21/CN5.1 </td><td>PA8 (BlueNRG-LP UART RX) (1) </td></tr>
<tr>
<td><b> UART RX </b></td><td>PA10/CN10.33/CN9.3 </td><td>PA9 (BlueNRG-LP UART TX) (1) </td></tr>
<tr>
<td><b> UPDATER_ACTIVATION</b></td><td>PA7/CN10.15/CN5.4 </td><td>PA15 (BlueNRG-LP)  </td></tr>
<tr>
<td><b> UART TX </b></td><td>PA9/CN10.21/CN5.1 </td><td>PB0 (BlueNRG-LPS UART RX) </td></tr>
<tr>
<td><b> UART RX </b></td><td>PA10/CN10.33/CN9.3 </td><td>PA1 (BlueNRG-LPS UART TX) </td></tr>
<tr>
<td><b> UPDATER_ACTIVATION</b></td><td>PA7/CN10.15/CN5.4 </td><td>PA11 (BlueNRG-LPS)  </td></tr>
<tr>
<td><b> RESETN </b></td><td>PA8/CN10.23/CN9.8 </td><td>RESETN (BlueNRG-LP/LPS) </td></tr>
<tr>
<td><b> VDD </b></td><td>VDD </td><td>JP2,pin 2 (2) </td></tr>
<tr>
<td><b> GND </b></td><td>GND </td><td>GND </td></tr>
<tr>
</tr>
</table>
<table class="doxtable">
</table>
<p>NOTES:  </p><ul>
<li>
(1) On STEVAL-IDB011V{1|2} add a 0 ohm resistor on R22 (PA9) and R24 (PA8). </li>
<li>
(2) Unplug USB connector from CN6. </li>
</ul>
<h1><a class="anchor" id="U3"></a>
Software Prerequisites: SW Configuration</h1>
<ul>
<li>The following SW steps must be performed on the selected Bluetooth LE platform: <ul>
<li>
Configure the BlueNRG-LP/BlueNRG-LPS device as a network co-processor (UART mode), by loading the available binary images (using the "drag and drop" mass storage upgrade capability by selecting the associated IDB01xv1 platform on PC Computer Window). </li>
<li>
Related binary files are: <ul>
<li>
Firmware\BLE_Examples\DTM\STEVAL-IDB011V1\DTM_UART_WITH_UPDATER.hex for the selected BlueNRG-LP platform (921600 baudrate). </li>
<li>
Firmware\BLE_Examples\DTM\STEVAL-IDB012V1\DTM_UART_WITH_UPDATER.hex for the selected BlueNRG-LPS platform (921600 baudrate).</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="U4"></a>
External Microcontroller Network co-processor framework structure</h1>
<table  border="1">
<tr>
<th></th><th>Path </th><th>Description  </th></tr>
<tr>
<td><b> Nucleo-L476RG SDK Drivers </b></td><td>Drivers\External_micro\BSP\STM32Lxx_Nucleo </td><td>SDK Drivers for NUCLEOE-L476RG Leds, COM, timers </td></tr>
<tr>
<td><b> STM32L4 Nucleo - BlueNRG-LP/LPS </b></td><td>Drivers\External_micro\BSP\STM32Lxx_BlueNRGLP </td><td>NUCLEO-L476RG UART driver for interfacing to BlueNRG-LP/LPS network co-processor  </td></tr>
<tr>
<td><b> STM32L4 CMSIS </b></td><td>Drivers\External_micro\CMSIS </td><td>CMSIS files for STM32LXXX  </td></tr>
<tr>
<td><b> STM32L4 drivers </b></td><td>Drivers\External_micro\STM32L4xx_HAL_Driver </td><td>STM32L4xx drivers </td></tr>
<tr>
<td><b> HAL drivers </b></td><td>Middlewares\ST\External_micro\HAL </td><td>HAL drivers (osal, timers, clock) </td></tr>
<tr>
<td><b> ACI framework </b></td><td>Middlewares\ST\External_micro\SimpleBlueNRG-LP_HCI </td><td>Bluetooth LE stack ACI framework APIs for interfacing to the BlueNRG-LP/LPS Bluetooth LE stack features and events </td></tr>
<tr>
<td><b> Bluetooth LE Beacon emonstration application </b></td><td>Project\External_micro\BLE_Beacon_NWK </td><td>Bluetooth LE application configuring a device as a Bluetooth LE Beacon </td></tr>
<tr>
<td><b> Bluetooth LE Direct Test Mode application </b></td><td>Project\External_micro\DTM_NWK </td><td>Bluetooth LE application allowing to use the BlueNRG GUI PC application (STSW-BRNGUI) </td></tr>
<tr>
<td><b> Bluetooth LE Sensor Demo application </b></td><td>Project\External_micro\BLE_SensorDemo_NWK </td><td>Bluetooth LE demo application interacting with the ST BlueNRG Sensor smartphone app</td></tr>
<tr>
<td><b> Bluetooth LE Stack, Device Configuration updater application </b></td><td>Project\External_micro\BLE_StackDevConfigUpdater_NWK </td><td>Bluetooth LE demo application targeting BLE Stack/Device Configuration updater features </td></tr>
<tr>
<td><b> Bluetooth LE Serial Port Master and Slave Demo application </b></td><td>Project\External_micro\BLE_SerialPort_MasterSlave_NWK </td><td>Bluetooth LE serial communication emulation through Bluetooth LE  </td></tr>
</table>
<h1><a class="anchor" id="U5"></a>
Demonstration Applications</h1>
<ul>
<li>The following NUCLEO L476RG - BlueNRG-LP/BlueNRG-LPS network co-processor (UART mode) demonstrations application are available (EWARM IAR toolchain 8.40 or later): <ol>
<li>
<b>BLE Beacon </b> application which configures a beacon device: <ul>
<li>
IAR project supporting NUCLEO L476RG and UART (compatible with DTM_UART_WITH_UPDATER.hex available on \Firmware\BLE_Examples\{STEVAL-IDB011V1|STEVAL-IDB012V1}\DTM folders) <ul>
<li>
UART workspaces: Release_UART (serial baudrate: 921600).</li>
</ul>
</li>
</ul>
</li>
<li>
<b>BLE Serial Port Master &amp; Slave </b> application which allows to target a Bluetooth LE Serial Port application scenario with same binary image:<ul>
<li>
IAR project supporting NUCLEO L476RG and UART (compatible with DTM_UART_WITH_UPDATER.hex available on \Firmware\BLE_Examples\{STEVAL-IDB011V1|STEVAL-IDB012V1}\DTM folders). <ul>
<li>
UART workspaces: Release_UART (serial baudrate: 921600).</li>
</ul>
</li>
</ul>
</li>
<li>
<b> Sensor Demo </b>application with emulated acceleration and environmental sensors values (emulated): <ul>
<li>
IAR project supporting NUCLEO L476RG and UART (compatible with DTM_UART_WITH_UPDATER.hex available on \Firmware\BLE_Examples\{STEVAL-IDB011V1|STEVAL-IDB012V1}\DTM folders). <ul>
<li>
UART workspaces: Release_UART (serial baudrate: 921600).</li>
</ul>
</li>
</ul>
</li>
<li>
<b> BLE Stack/Device Configuration updater </b>application for DTM/BLE stack FW update and Device configuration update : <ul>
<li>
IAR project supporting NUCLEO L476RG and UART (compatible with DTM_UART_WITH_UPDATER.hex available on \Firmware\BLE_Examples\{STEVAL-IDB011V1|STEVAL-IDB012V1}\DTM folders). <ul>
<li>
UART workspaces (serial baudrate: 921600): DevConfig_Updater_UART, Stack_Updater_UART, Stack_Updater_Ymodem_UART.</li>
</ul>
</li>
</ul>
</li>
<li>
<b> DTM </b>application to be programmed on STM32L4- NUCLEO L476RG in order to use the BlueNRG GUI tool (file STM32L_Nucleo_DTM_UART.hex): <ul>
<li>
IAR project supporting NUCLEO L476RG and UART (compatible with DTM_UART_WITH_UPDATER.hex available on \Firmware\BLE_Examples\{STEVAL-IDB011V1|STEVAL-IDB012V1}\DTM folders). <ul>
<li>
UART workspaces: DTM_UART (serial baudrate: 921600).</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
<li>NOTES: <ul>
<li>
Prebuilt binary images for BlueNRG-LP/BlueNRG-LPS (DTM/DTM_basic) and STM32L4- NUCLEO L476RG are available, respectively, on \Firmware\BLE_Examples\{STEVAL-IDB011V1|STEVAL-IDB012V1}\{DTM|DTM_basic} folders and \Firmware\External_micro folder </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="U6"></a>
Network co-processor application structure</h1>
<ul>
<li>This section provides the main guidelines to be followed when implementing a NUCLEO L476RG - BlueNRG-LP/BlueNRG-LPS demo application (project structure, main() layout, APP_Tick() layout, event callbacks management).</li>
</ul>
<h2><a class="anchor" id="U61"></a>
Project structure</h2>
<table  border="0">
<tr>
<th></th></tr>
<tr>
<td><div class="image">
<img src="Figure_1.png" />
</div>
   </td></tr>
<tr align="center">
<td><b style="font-size: 18px; color:blue;"> Figure 1: Bluetooth LE Beacon Demo, Release_UART configuration example </b>  </td></tr>
</table>
<ul>
<li>Figure 1 shows the project structure of the STM32L-BlueNRG-LP/BlueNRG-LPS Bluetooth LE Beacon application (BLE_Beacon_NWK_UART workspace). This framework can be taken as reference for implementing any network co-processor application.</li>
</ul>
<h2><a class="anchor" id="U62"></a>
Application structure: Main function</h2>
<table  border="0">
<tr>
<th></th></tr>
<tr>
<td><div class="image">
<img src="Figure_2.png" />
</div>
   </td></tr>
<tr align="center">
<td><b style="font-size: 18px; color:blue;"> Figure 2: Bluetooth LE Beacon Demo, main() Function </b>  </td></tr>
</table>
<ul>
<li>Figure 2 shows the application main() structure of the STM32L-BlueNRG-LP/BlueNRG-LPS Bluetooth LE Beacon application (it's a typical framework which can be taken as reference for any other application with proper customization): <ol>
<li>
SystemInit_NWK(): it initializes the NUCLEO L476RG, STM32L4 device (HAL, clock, ...) and the UART interface for BlueNRG-LP/BlueNRG-LPS network co-processor. </li>
<li>
BlueNRG_Stack_Initialization(): it initializes the ACI framework lists and it reset the BlueNRG-LP/BlueNRG-LPS device </li>
<li>
Device_Init(): it calls the BlueNRG-LP/BlueNRG-LPS APIs for configuring the Bluetooth LE stack (set public address, initialize GATT and GAP layers, set TX power level ...) </li>
<li>
BTLE_StackTick(): Bluetooth LE stack tick APIs which allows to process the Bluetooth LE stack events coming from BlueNRG-LP/BlueNRG-LPS, Bluetooth LE stack. </li>
<li>
APP_Tick(): application tick function which implements the application specific state machine (to be added on main, while(1) loop and customized based on user application scenario)</li>
</ol>
</li>
</ul>
<ul>
<li>NOTE: The External microcontroller - BlueNRG-LP/BlueNRG-LPS, Bluetooth LE APIs protoypes are defined on the Middlewares\ST\External_micro\SimpleBlueNRG-LP_HCI\includes\ folder header files (bluenrg-lp_gap_aci.h, bluenrg-lp_gatt_aci.h, bluenrg-lp_l2cap_aci.h, bluenrg-lp_hal_aci.h, bluenrg-lp_hci_le.h, bluenrg-lp_hal_aci.h). </li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright &copy; 2022 by STMicrolectronics. All rights reserved.<br>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
