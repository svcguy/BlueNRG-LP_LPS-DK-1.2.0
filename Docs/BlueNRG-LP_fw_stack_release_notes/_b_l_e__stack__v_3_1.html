<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>BlueNRG-LP/BlueNRG-LPS Bluetooth Low Energy Stack: BlueNRG-BLE Stack Library v_3_1 (14-May-2021)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="STcustom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ST-logo-small.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BlueNRG-LP/BlueNRG-LPS Bluetooth Low Energy Stack
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">BlueNRG-BLE Stack Library v_3_1 (14-May-2021) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="S1"></a>
Bluetooth Low Energy (LE) stack binary image files</h1>
<p>This section lists the Bluetooth LE Stack Library binary file to be used for the BlueNRG-LP/BlueNRG-LPS Systems On Chip configuration: <br />
</p>
<ul>
<li>libbluenrglp_stack.a binary library <b>v3.1</b> with following main features: <ul>
<li>
Bluetooth LE 5.x specifications </li>
<li>
Direction Findings (AoA, AoD) [supported only on BlueNRG-LPS device] </li>
<li>
LE Data Packet Length Extension </li>
<li>
LE Secure Connections </li>
<li>
Link Layer Privacy </li>
<li>
2Mbps PHY </li>
<li>
LE Long Range (Coded PHY) </li>
<li>
High Duty Cycle Non-Connectable Advertising </li>
<li>
Extended advertising and scanning </li>
<li>
LE Channel Selection Algorithm #2 </li>
<li>
GATT Robust Caching </li>
<li>
Periodic Advertising and Periodic Advertising Sync Transfer </li>
<li>
LE Ping procedure </li>
<li>
LE L2CAP Connection-Oriented Channel support </li>
<li>
LE Power Control &amp; Path Loss Monitoring support </li>
<li>
Connection robustness mechanism: <ul>
<li>
It allows to tolerate delayed execution of Radio ISR by skipping connection events but not dropping the connection.</li>
</ul>
</li>
<li>
Multiple/concurrent active links supported (tested up to 24) </li>
<li>
Link statistics </li>
<li>
New GATT layer framework and updated commands/events interface: <ul>
<li>
It allows to handle GATT attributes values directly into user application, leaving to the Bluetooth LE library the ownership of data-transfer only.</li>
</ul>
</li>
<li>
New GAP layer APIs for advertising, scanning and connection procedures </li>
<li>
Support and integration of the new Timer module external to Bluetooth LE Library </li>
<li>
Support and integration of the new NVM module external to to Bluetooth LE Library </li>
<li>
ATT Maximum Transmission Unit (MTU) size is 1020 octets. </li>
<li>
L2CAP Maximum Payload Size (MPS) size is 1024 octets. </li>
<li>
MISRA-C:2012 compliance </li>
<li>
Bluetooth LE stack modular configurations allowing to optimize Bluetooth LE stack memory footprints based on user application scenario </li>
</ul>
</li>
<li><b>NOTES</b>: <ul>
<li>
libbluenrg_lp_stack.a binary library file <b>v3.1</b> is available in folder: <b>Middlewares\ST\Bluetooth_LE\Library</b>. The binary file must be linked to the built user application in order to get access to the Bluetooth LE stack features. </li>
<li>
libbluenrg_lp_stack.a is valid for the following supported toolchains: IAR-EWARM, ARM Keil MDK. </li>
<li>
When adding libbluenrg_lp_stack.a on a Keil project, just change the related File Type to Library File (from file Options). </li>
<li>
Configuration files stack_user_cfg.[c/h] are used for enabling the Bluetooth LE stack v3.x modular approach </li>
<li>
AES CMAC encryption functionality required by Bluetooth LE stack v3.x is available on new standalone binary library: Middlewares\ST\cryptolib\cryptolib.a </li>
<li>
Vendor Specific Error Codes values have been updated in order to align to new BLE Standard Error Codes added by BLE Specifications v.5.2: <ul>
<li>
All ST BlueNRG-BLE Stack Library v2.x error codes from value 0x40 have been shifted forward, starting from value 0x80. </li>
<li>
The new values are defined in the ble_status.h file </li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="S10"></a>
Bluetooth LE stack modular configurations options</h2>
<ul>
<li>Some predefined sets of <b>BlueNRG-BLE Stack Library</b> modular configurations options are available: <ol>
<li>
<b> BLE_STACK_FULL_CONF </b> &ndash;&gt; preprocessor option to be added on Bluetooth LE user application IDE toolchain, for configuring the Bluetooth LE stack with all supported modular features: <ul>
<li>
Controller Privacy is enabled </li>
<li>
LE Secure Connection is enabled </li>
<li>
Master role is enabled </li>
<li>
Data length extension is enabled </li>
<li>
LE 2M PHY, LE CODED PHY are enabled </li>
<li>
Extended Advertising is enabled </li>
<li>
LE L2CAP Connection-Oriented Channels is enabled </li>
<li>
Periodic advertising and sync transfer is enabled </li>
<li>
Constant Tone Extension is enabled (where applicable: not supported on BlueNRG-LP device) </li>
<li>
LE Power Control is enabled</li>
</ul>
</li>
<li>
<b>BLE_STACK_BASIC_CONF</b> &ndash;&gt; preprocessor option to be added on Bluetooth LE user application IDE toolchain for configuring the Bluetooth LE stack with the basic configuration options: <ul>
<li>
Controller Privacy is disabled </li>
<li>
LE Secure Connection is disabled </li>
<li>
Master role is disabled (only Peripheral/Slave role is supported) </li>
<li>
Data length extension is disabled </li>
<li>
LE 2M PHY, LE CODED PHY are disabled </li>
<li>
Extended Advertising is disabled </li>
<li>
LE L2CAP Connection-Oriented Channels is disabled </li>
<li>
Periodic advertising and sync transfer is disabled </li>
<li>
Constant Tone Extension is disabled </li>
<li>
LE Power Control is disabled</li>
</ul>
</li>
<li>
<b>BLE_STACK_SLAVE_DLE_CONF </b> &ndash;&gt; preprocessor option to be added on Bluetooth LE user application IDE toolchain for selecting the OTA Service support with Data length extension: <ul>
<li>
Controller Privacy is disabled </li>
<li>
LE Secure Connections is disabled </li>
<li>
Master role is disabled (only Peripheral/Slave role is supported) </li>
<li>
Data length extension is enabled </li>
<li>
LE 2M PHY and LE CODED PHY are disabled </li>
<li>
Extended Advertising is disabled </li>
<li>
LE L2CAP Connection-Oriented Channels is disabled </li>
<li>
Periodic advertising and sync transfer is disabled </li>
<li>
Constant Tone Extension is disabled </li>
<li>
LE Power Control is disabled</li>
</ul>
</li>
</ol>
</li>
<li>NOTES: <ul>
<li>
Files stack_user_cfg.[c/h] must not be modified by user. </li>
<li>
<b>BLE_STACK_CUSTOM_CONF</b> option is also available for allowing user to define specific set of Bluetooth LE modular configuration options on a dedicated header file:<ul>
<li>
"custom_ble_stack_conf.h" to be placed on user demonstration application Inc folder. This allows user to select only the Bluetooth LE features required for the specific application scenario, and to optimize the application memory footprints.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="S11"></a>
Bluetooth Low Energy (LE) stack network coprocessor configuration</h1>
<ul>
<li>The following network coprocessor modes are supported when using BlueNRG GUI and DTM application: UART (mainly for RF evaluation purpose) and SPI. </li>
<li>DTM project and related workspaces provides reference applications for configuring the BlueNRG-LP/BlueNRG-LPS platforms as a network coprocessor (refer to BlueNRG-LP DK Release notes documentation for more information).</li>
</ul>
<h1><a class="anchor" id="S12"></a>
New Features</h1>
<p>This section lists the new features compared to previous Bluetooth LE Stack Library<br />
</p>
<ul>
<li>Added support for Direction Finding (AoA, AoD) features </li>
<li>Added support for Bluetooth Low Energy Periodic Advertising and Periodic Synchronization Transfer (PAST) features </li>
<li>Added support for LE Power Control feature &amp; Path Loss Monitoring </li>
<li>Added new task scheduler which optimizes the Bluetooth LE stack library execution time </li>
<li>Added access to BLE Controller API through integration of new platform-abstraction level driver </li>
<li>Added initialization of global RAM tables performed through BLE Controller platform-level driver </li>
<li>Added access to AES128 peripheral through integration of new platform-level driver </li>
<li>Added access to RNG peripheral through integration of new platform-level driver </li>
<li>Added access to PKA peripheral through integration of new platform-level driver </li>
<li>Added Set scan channel feature </li>
<li>Improved channel statistics functionality: add number of missed packets value </li>
<li>Added new HCI LE TRANSMITTER TEST V3/V4 command </li>
<li>Added new API for setting CCCD value </li>
<li>Added a function for reading the value of a connection handle dependent attribute value </li>
<li>Updated ll_get_advertising_info for periodic advertising prototype for Periodic Advertising support </li>
<li>Updated Bluetooth LE stack init APIs parameters BLE_STACK_InitTypeDef structure) : <ul>
<li>
Added NumOfSyncSlots parameter (Maximum number of slots for synchronizing, valid only when Periodic Advertising and Synchronizing Feature is enabled) </li>
<li>
Added CTE_MaxNumAntennaIDs and CTE_MaxNumIQSamples parameters (reserved for future use) </li>
<li>
Added isr0_fifo_size, isr1_fifo_size, user_fifo_size parameters (events FIFO sizes tuning for multiple connections scenarios) </li>
<li>
Removed HotAnaConfigTable parameter </li>
</ul>
</li>
<li>aci_gap_set_io_capability() can be always submitted, except during an on-going pairing procedure (on any active connection). </li>
<li>New GAP command to clear/remove an advertising set.</li>
</ul>
<ul>
<li>NOTES: <ul>
<li>
Refer to <a href="../BlueNRG-LP_BLE_stacks_migration/index.html">Bluetooth LE Stack v2.x to v3.x migration guideline html documentation </a> for information about how to port an application from BLE stack v2.x to v3.x and later. </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="S13"></a>
Solved Issues</h1>
<p>This section lists the solved issues compared to previous Bluetooth LE Stack Library v3_0</p>
<ul>
<li>ID 862297: HCI Read RSSI command sometimes returns a RSSI value of 127 (not available) </li>
<li>ID 847128: Unspecified Reason (instead of Authentication Requirements) returned in Pairing Failed in case of SC-Only Mode mismatch. </li>
<li>ID 847804: Not possible to change TX power for leagcy transmitter tests. </li>
<li>ID 847973: Changed priority of periodic events vs advertising events: too many skipped advertising events were causing random fails of tests. </li>
<li>ID 774287: The first advertising event is sent after one advertising interval. Time to start advertising is now reduced. </li>
<li>ID 808391: BLE Errata 13425: allow LE Secure Connections on LE Security Mode 1 Level 2 and 3 </li>
<li>ID 760111: Bluetooth SECURITY Notice: CVE-2020-26558 (Impersonation in the Passkey Entry Protocol in LE-SC Pairing) </li>
<li>ID 760101: Bluetooth SECURITY Notice: LE Legacy Pairing authentication </li>
<li>ID 686575: Updated behavior upon attempt to connect to an already connected peer device: error 0x0B ("Connection already exists") is now returned. </li>
<li>ID 759709: No packets received during receiver test when Data Length Extension is disabled and data length is greater than 31 octets. </li>
<li>ID 758628: Failure of PAST procedure if data length extension is disabled by modularity </li>
<li>ID 754897: Database Out Of Sync error code is not returned by ATT_FIND_INFORMATION_REQ and ATT_FIND_BY_TYPE_VALUE_REQ. </li>
<li>ID 753827: Supervision timeout not properly decremented whenever a slot is skipped </li>
<li>ID 753825: Receive timeout value may be corrupted when advertising is started and other links are active. </li>
<li>ID 749513: No error is generated in case a taskslot is not available for the periodic advertiser taskslot. </li>
<li>ID 747707: When adverting is active in parallel to other links the number of sent events may be lower than Max_Extended_Advertising_Events. </li>
<li>ID 747230: No error is given if advertising configuration is changed when adverting is enabled on the same advertising handle. </li>
<li>ID 746884: Disconnections in multi connection scenario (more than 40 links). </li>
<li>ID 724809: aci_gap_get_security_level does not return security level 4 </li>
<li>ID 711566: Inconsistent GAP state when the autoconnection procedure is aborted and immediately restarted. </li>
<li>ID 814516: Link disconnected when a new connection is created with coded PHY </li>
<li>ID 778561: Pairing Timeout in case of simultaneous request from Initiator and Responder </li>
<li>ID 758706: Receive window is opened too early in slave role. </li>
<li>ID 746192: ATT packet size check not done before checking attribute handle range. </li>
<li>ID 742729: GATT Server doesn't correctly store Client Supported Feature values. </li>
<li>ID 741524: The maximum number of links supported by the Stack is limited to 24 links. </li>
<li>ID 741520: Memory corruption in multi-connection scenario. </li>
<li>ID 721247: The connection event is wrongly closed by the Slave when a CRC error is received. </li>
<li>ID 721226: PLL calibration request and the automatic channel incrementer are not disabled when a transmitted packet is not acknowledged. Due to this, the packet is transmitted again, but with a wrong IFS (greater than 150 us). </li>
<li>ID 753222: RSSI value returned by HCI_READ_RSSI command is always 127 dBm when role is master. </li>
<li>ID 753125: Scannning cannot be stopped if only CONTROLLER_MASTER_ENABLED is set. </li>
<li>ID 750201: L2CAP recombination error after a Data Length update procedure. </li>
<li>ID 750085: When CONTROLLER_EXT_ADV_SCAN_ENABLED is set to 0 (extended advertising disabled), the macro BLE_STACK_TOTAL_BUFFER_SIZE returns an underestimated value. </li>
<li>ID 753308: When an L2CAP_COMMAND_REJECT_RSP is received with Reason 0x0000 ('Command not understood') a L2CAP Reject Event is generated with reason 0x02.</li>
</ul>
<h1><a class="anchor" id="S14"></a>
Limitations/Bugs</h1>
<p>This section lists the issues known at firmware image release time. Issues found after this release are listed as solved or limitations on newer releases. <br />
</p>
<ul>
<li>No known issues.</li>
</ul>
<h1><a class="anchor" id="S15"></a>
Documentation</h1>
<ul>
<li>Refer to <a href="../BlueNRG-LP_aci_events/files.html">Bluetooth Low Energy (LE) API and events html documentation </a> for detailed description of Bluetooth LE stack APIs and related events callbacks. </li>
<li>Refer to <a href="../BlueNRG-LP_BLE_stacks_migration/index.html">Bluetooth LE stack migration guidelines from v2.x to v3.x html documentation </a> for guidelines about how to migrate applications from Bluetooth low energy stack v2.x to v3.x. </li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright &copy; 2022 by STMicrolectronics. All rights reserved.<br>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
