<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>BlueNRG-LP/BlueNRG-LPS Peripherals HAL drivers APIs: rf_driver_hal_vtimer.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ST-logo-small.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BlueNRG-LP/BlueNRG-LPS Peripherals HAL drivers APIs
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">rf_driver_hal_vtimer.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="rf__driver__hal__vtimer_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">/* Includes ------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &lt;stddef.h&gt;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="rf__driver__hal__vtimer_8h.html">rf_driver_hal_vtimer.h</a>&quot;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#define ATOMIC_SECTION_BEGIN() uint32_t uwPRIMASK_Bit = __get_PRIMASK(); \</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">                                __disable_irq(); \</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor"></span><span class="comment">/* Must be called in the same scope of ATOMIC_SECTION_BEGIN */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#define ATOMIC_SECTION_END() __set_PRIMASK(uwPRIMASK_Bit)</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#define MAX(a,b) ((a) &lt; (b) )? (b) : (a)</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#define MIN(a,b) ((a) &lt; (b) )? (a) : (b)</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#define DIFF8(a,b) ((a)&gt;=(b) ? ((a)-(b)) : (256+((a)-(b))))</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#define INCREMENT_EXPIRE_COUNT_ISR (HAL_VTIMER_Context.expired_count = ((HAL_VTIMER_Context.expired_count + 1) == HAL_VTIMER_Context.served_count) ? HAL_VTIMER_Context.expired_count : (HAL_VTIMER_Context.expired_count + 1))</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#define INCREMENT_EXPIRE_COUNT ATOMIC_SECTION_BEGIN(); INCREMENT_EXPIRE_COUNT_ISR ; ATOMIC_SECTION_END();</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#define BLE_TX_RX_EXCEPTION_NUMBER 18</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">/*Minimum threshold to safely program the radio timer (expressed in STU) */</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#define TIMER1_MARGIN (10)</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                                  </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">/*  Delay to program a radio timer in the worst case (in STU).</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">  This is the sum of: 1st init dalay, 2 init delay and tx delay (118 + 65 + 2)  */</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#define TIMER1_INIT_DELAY (76)</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">/* Minimum threshold in STU to safely clear radio timers.</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">The wakeup timer in the worst case triggers about 30us in advance.</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">This must be considered when the radio timer is cleared.</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">Then a window of about 30 us is considered as critical, that is </span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">it is not sure the timer can be cleared properly */</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">#define CLEAR_MIN_THR (15)</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">/* Threshold to take into account the calibration duration. */</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#define CALIB_SAFE_THR (370)</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">/* Extra margin to consider before going in low power mode */</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor">#define LOW_POWER_THR (30)</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">/* HOST_MARGIN is the margin in STU needed to program a pending radio operation after the host timer is triggered */</span>                               </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">#define HOST_MARGIN (200)</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="struct_h_a_l___v_t_i_m_e_r___context_s.html">  126</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html">HAL_VTIMER_ContextS</a> {</div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a56a5ec998fc953d22310ffc8ed5455ee">  127</a></span>&#160;  uint32_t <a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a56a5ec998fc953d22310ffc8ed5455ee">PeriodicCalibrationInterval</a>;  </div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a8be087d5097e059cf2c64172d741c76e">  128</a></span>&#160;  BOOL <a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a8be087d5097e059cf2c64172d741c76e">calibration_in_progress</a>;  </div>
<div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">  129</a></span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>; </div>
<div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#ad191a5b8142d56344dd526de70c33eea">  130</a></span>&#160;  BOOL <a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#ad191a5b8142d56344dd526de70c33eea">enableTimeBase</a>;      </div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a409e439f10c0b0a2d62eed495a10e62b">  131</a></span>&#160;  uint32_t <a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a409e439f10c0b0a2d62eed495a10e62b">hs_startup_time</a>; </div>
<div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a469e12352153c7f79bb360af025be558">  132</a></span>&#160;  uint8_t <a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a469e12352153c7f79bb360af025be558">expired_count</a>; </div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a6a6415f8e6d477e1f1a29b0157b91224">  133</a></span>&#160;  uint8_t <a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a6a6415f8e6d477e1f1a29b0157b91224">served_count</a>; </div>
<div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a1ee031d20e170349064d749b04168241">  134</a></span>&#160;  uint8_t <a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a1ee031d20e170349064d749b04168241">wakeup_calibration</a>; </div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a985631f2067fdf6bcd40228e5634b2d0">  135</a></span>&#160;  uint8_t <a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a985631f2067fdf6bcd40228e5634b2d0">stop_notimer_action</a>; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;} <a class="code" href="group___v_t_i_m_e_r___private___types.html#ga8fe244106cd42470148924a013d3de99">HAL_VTIMER_ContextType</a>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="struct_v_t_i_m_e_r___radio_handle_type_s.html">  138</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html">VTIMER_RadioHandleTypeS</a> {</div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">  139</a></span>&#160;    uint64_t <a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a>;</div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a0072edb361743a559932f59cf591fe26">  140</a></span>&#160;    BOOL <a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a0072edb361743a559932f59cf591fe26">cal_req</a>;</div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">  141</a></span>&#160;    BOOL <a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">active</a>;</div>
<div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a22b9bda680e9f825fe56a0dd54ab3ef3">  142</a></span>&#160;    BOOL <a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a22b9bda680e9f825fe56a0dd54ab3ef3">pending</a>;</div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a04de9dbee80ed37f59e20974de549ad6">  143</a></span>&#160;    BOOL <a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a04de9dbee80ed37f59e20974de549ad6">intTxRx_to_be_served</a>;</div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a3c962931bc008b457e00a49273bd8ecb">  144</a></span>&#160;    BOOL <a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a3c962931bc008b457e00a49273bd8ecb">event_type</a>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;} <a class="code" href="group___v_t_i_m_e_r___private___types.html#ga086868b0dd0e542f8167e889547c32e8">VTIMER_RadioHandleType</a>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="keyword">static</span> <a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html">HAL_VTIMER_ContextType</a> HAL_VTIMER_Context;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="keyword">static</span> <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> calibrationTimer;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keyword">static</span> <a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html">VTIMER_RadioHandleType</a> radioTimer;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">/* If hostIsRadioPending is true, the virtual timer callback will be triggered when the wakeup timer triggers */</span> </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="keyword">static</span> uint8_t hostIsRadioPending;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">/* It depends on the hs startup time. See HOST_MARGIN */</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="keyword">static</span> uint32_t hostMargin;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">/* Wait the next calibration to get the latest values */</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keyword">static</span> uint8_t waitCal;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="keyword">static</span> TIMER_CalibrationType calibrationData;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">/*Check if it is time to program the pending radio timer (large timeouts).</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">1) The radio event is before the next calibration event. Then the timer must be programmed.</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">2) The calibration timer expired but the calibration didn&#39;t start and the values not updated as expected.</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">   Then the next calibration event is missleading. The radio timer must be programmed.</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">3) The radio event is after the next calibration event. Then the timer will be programmed with the latest values.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">The check on the next calibration event is made even though the calibration is disabled (max cal. interval)</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">in order to avoid counter wrapping with timeouts far in the future.</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> _check_radio_activity(<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html">VTIMER_RadioHandleType</a> * timerHandle, uint8_t *expired)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;{</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  uint64_t nextCalibrationEvent, currentTime; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                 </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  *expired = 0;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordflow">if</span> (timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a22b9bda680e9f825fe56a0dd54ab3ef3">pending</a>){</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    nextCalibrationEvent = calibrationData.last_calibration_time + \</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                           HAL_VTIMER_Context.PeriodicCalibrationInterval;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    ATOMIC_SECTION_BEGIN();</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    currentTime = TIMER_GetCurrentSysTime();</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">if</span>((timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a> &lt; (nextCalibrationEvent + RADIO_ACTIVITY_MARGIN)) \</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                                    || \</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      (currentTime &gt; (nextCalibrationEvent + CALIB_SAFE_THR)))</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;     {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;       <span class="keywordflow">if</span> (timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a> - TIMER1_INIT_DELAY &gt; (currentTime + TIMER1_MARGIN)){</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        *expired = TIMER_SetRadioTimerValue(timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a>, timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a3c962931bc008b457e00a49273bd8ecb">event_type</a>,timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a0072edb361743a559932f59cf591fe26">cal_req</a>);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a22b9bda680e9f825fe56a0dd54ab3ef3">pending</a> = FALSE; <span class="comment">/* timer has been served. No more pending */</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">active</a> = TRUE; <span class="comment">/* timer has been programmed and it becomes ACTIVE */</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a04de9dbee80ed37f59e20974de549ad6">intTxRx_to_be_served</a> = TRUE;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        ATOMIC_SECTION_END();</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a22b9bda680e9f825fe56a0dd54ab3ef3">pending</a> = FALSE;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        ATOMIC_SECTION_END();</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        *expired = 1;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      waitCal = 1;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      ATOMIC_SECTION_END();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> calibration_callback (<span class="keywordtype">void</span> *handle)</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;{</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  TIMER_StartCalibration();</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a8be087d5097e059cf2c64172d741c76e">calibration_in_progress</a> = TRUE;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="keyword">static</span> <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> * _remove_timer_in_queue(<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *rootNode, <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *handle)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;{</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *current = rootNode;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *prev = NULL;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *returnValue = rootNode;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">while</span> ((current!=NULL) &amp;&amp; (current != handle)) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    prev = current;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    current=current-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">next</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordflow">if</span> (current == NULL) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">/* Not found */</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  }</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (current == rootNode) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">/* New root node */</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    returnValue = current-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">next</a>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    prev-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">next</a> = current-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">next</a>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordflow">return</span> returnValue;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;}</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keyword">static</span> <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> * _insert_timer_in_queue(<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *rootNode, <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *handle)</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;{</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *current = rootNode;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *prev = NULL;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *returnValue = rootNode;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">while</span> ((current!=NULL) &amp;&amp; (current-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a9528c6497645126b8293fffd4b16fc8c">expiryTime</a> &lt; handle-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a9528c6497645126b8293fffd4b16fc8c">expiryTime</a>)) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    prev = current;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    current=current-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">next</a>;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  handle-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">next</a> = current;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">if</span> (prev == NULL) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">/* We are the new root */</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    returnValue = handle;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    prev-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">next</a> = handle;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordflow">return</span> returnValue;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;}</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">/* Set timeout and skip non active timers */</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="keyword">static</span> <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *_update_user_timeout(<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *rootNode, uint8_t *expired)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;{</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *curr = rootNode;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *rootOrig = rootNode;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  int64_t delay;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  *expired =0;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordflow">while</span> (curr != NULL) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> (curr-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a29166f80ce4b5c58d419312f78bacb96">active</a>) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      ATOMIC_SECTION_BEGIN();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      uint8_t dummy;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      BOOL share = FALSE;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      _check_radio_activity(&amp;radioTimer,&amp;dummy);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      delay = curr-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a9528c6497645126b8293fffd4b16fc8c">expiryTime</a>-TIMER_GetCurrentSysTime();</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keywordflow">if</span> (delay &gt; 0) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="comment">/* Protection against interrupt must be used to avoid that the called function will be interrupted</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">          and so the timer programming will happen after the target time is already passed</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">          leading to a timer expiring after timer wraps, instead of the expected delay */</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="comment">/* Is the active radio operation before or too close the host timeout? */</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">if</span>(((radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a>) &lt; (curr-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a9528c6497645126b8293fffd4b16fc8c">expiryTime</a> + hostMargin)) &amp;&amp; radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">active</a>)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          <span class="keywordflow">if</span>((radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a> &gt;= curr-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a9528c6497645126b8293fffd4b16fc8c">expiryTime</a>) &amp;&amp; radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">active</a>)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;          {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            hostIsRadioPending = 1;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;          }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;          <span class="comment">/* It&#39;s fine to program the wakeup timer for an host wakeup */</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;          share = TRUE;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        TIMER_SetRadioHostWakeupTime(delay, &amp;share);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">if</span>(share == TRUE)</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;          radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a22b9bda680e9f825fe56a0dd54ab3ef3">pending</a> |= radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">active</a>;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;          radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">active</a> = FALSE; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        TIMER_SetWakeupTime(delay, TRUE);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        ATOMIC_SECTION_END();</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        *expired = 1;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        ATOMIC_SECTION_END();</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    curr=curr-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">next</a>;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keywordflow">if</span> (*expired)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">return</span> rootOrig;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordflow">return</span> curr;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">/* Check the number of expired timer from rootNode (ordered list of timers) and return the list of expired timers */</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keyword">static</span> <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *_check_callbacks(<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *rootNode,<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> **expiredList)</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;{</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *curr = rootNode;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *prev = NULL;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *returnValue = rootNode;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  *expiredList = rootNode;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  int64_t delay;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  uint32_t expiredCount = 0;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordflow">while</span> (curr != NULL) {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">if</span> (curr-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a29166f80ce4b5c58d419312f78bacb96">active</a>) {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      delay = curr-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a9528c6497645126b8293fffd4b16fc8c">expiryTime</a>-TIMER_GetCurrentSysTime();</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="keywordflow">if</span> (delay &gt; 5) { <span class="comment">/*TBR*/</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="comment">/* End of expired timers list*/</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    } </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    prev = curr;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    curr=curr-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">next</a>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    expiredCount++;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordflow">if</span> (expiredCount) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="comment">/* Some timers expired */</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    prev-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">next</a>=NULL;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    returnValue = curr;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">/* No timer expired */</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    *expiredList = NULL;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordflow">return</span> returnValue;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;}</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> _check_host_activity(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;{</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  uint8_t expired;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a> = _update_user_timeout(HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>, &amp;expired);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordflow">if</span> (expired == 1) {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="comment">/* A new root timer is already expired, mimic timer expire */</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    INCREMENT_EXPIRE_COUNT_ISR;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;}</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> _start_timer(<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *timerHandle, uint64_t time)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;{</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  uint8_t expired = 0;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="comment">/* The timer is already started*/</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">if</span>(timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a29166f80ce4b5c58d419312f78bacb96">active</a>)</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a9528c6497645126b8293fffd4b16fc8c">expiryTime</a> = time;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a29166f80ce4b5c58d419312f78bacb96">active</a> = TRUE;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordflow">if</span> (_insert_timer_in_queue(HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>, timerHandle) == timerHandle) {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a> = _update_user_timeout(timerHandle, &amp;expired);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">if</span> (expired) {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="comment">/* A new root timer is already expired, mimic timer expire that is normally signaled</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">       through the interrupt handler that increase the number of expired timers*/</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      INCREMENT_EXPIRE_COUNT;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keywordflow">return</span> expired;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;}</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> _virtualTimeBaseEnable(FunctionalState state)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;{</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordflow">if</span>(state != DISABLE)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">if</span> (HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#ad191a5b8142d56344dd526de70c33eea">enableTimeBase</a> == FALSE)</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      calibration_callback(&amp;calibrationTimer);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#ad191a5b8142d56344dd526de70c33eea">enableTimeBase</a> = TRUE;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga44f91bce3a1a14dd44b71bdacec9ad2d">HAL_VTIMER_StopTimer</a>(&amp;calibrationTimer);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#ad191a5b8142d56344dd526de70c33eea">enableTimeBase</a> = FALSE;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;}</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> _set_controller_as_host(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;{</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  blueglob-&gt;BYTE4 &amp;= ~(1&lt;&lt;7);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  blueglob-&gt;BYTE22 = 0x0;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  blueglob-&gt;BYTE23 = 0x0;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;}</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00457"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#ga0965cae5f5c6c3509fbfedc0f97622ff">  457</a></span>&#160;<a class="code" href="group___v_t_i_m_e_r___exported___types.html#ga506797a0f088c9be2b06772066d5fcda">TimerStatus</a> <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga0965cae5f5c6c3509fbfedc0f97622ff">HAL_VTIMER_GetRadioTimerValue</a>(uint64_t *time)</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;{</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  *time = radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a>;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">if</span>((radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a22b9bda680e9f825fe56a0dd54ab3ef3">pending</a>) || (TIMER_GET_BLUE_WAKEUP_EN) || (TIMER_GET_TIMER1_STATUS))</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group___v_t_i_m_e_r___exported___types.html#gga506797a0f088c9be2b06772066d5fcdaa4d845c6aaa87e5237d2fa85b2ad1317e">RADIO_TIMER_PENDING</a>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group___v_t_i_m_e_r___exported___types.html#gga506797a0f088c9be2b06772066d5fcdaafbaf726116172c486424f1a03eca59cc">RADIO_TIMER_OFF</a>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;}</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#gae1d46c043469b27286d3583cffa1e894">  474</a></span>&#160;uint8_t <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#gae1d46c043469b27286d3583cffa1e894">HAL_VTIMER_ClearRadioTimerValue</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;{</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  int64_t time_diff;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  uint8_t retVal;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  TIMER_ClearRadioTimerValue();</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">active</a> = FALSE;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a22b9bda680e9f825fe56a0dd54ab3ef3">pending</a> = FALSE;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a04de9dbee80ed37f59e20974de549ad6">intTxRx_to_be_served</a> = FALSE;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">/*The rfSetup is different if Timer1 or Wakeup timer is programmed*/</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  ATOMIC_SECTION_BEGIN();</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  time_diff = radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a> \</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;              - TIMER_GetCurrentSysTime() \</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;              - __TIMER_GetSysRfSetupTime();</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  ATOMIC_SECTION_END();</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="comment">/* Check if the routine is executed in the Tx/Rx interrupt handler or not */</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keywordflow">if</span> (((SCB-&gt;ICSR &amp; SCB_ICSR_VECTACTIVE_Msk)-16) != BLE_TX_RX_EXCEPTION_NUMBER) {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    _check_host_activity();</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keywordflow">if</span>(time_diff &lt;= 0)</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    retVal = HAL_VTIMER_LATE;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (time_diff &lt; CLEAR_MIN_THR)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    retVal = HAL_VTIMER_CRITICAL;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    retVal = HAL_VTIMER_SUCCESS;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keywordflow">return</span> retVal;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;}</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00512"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#gaef9d6a69a3861fdcfdfe66cbda2c8814">  512</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#gaef9d6a69a3861fdcfdfe66cbda2c8814">HAL_VTIMER_StopRadioTimer2</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;{</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  TIMER_ClearRadioTimer2();</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;}</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00523"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#gac1b0eae9d27248ee7a721ae32fc9b90c">  523</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#gac1b0eae9d27248ee7a721ae32fc9b90c">HAL_VTIMER_WakeUpCallback</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;{</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;   <span class="keyword">volatile</span> uint32_t status;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;   uint8_t expired;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;   </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  _check_radio_activity(&amp;radioTimer,&amp;expired);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordflow">if</span>(hostIsRadioPending)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    hostIsRadioPending = 0;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga340e1a2a0814d3cd0e4c424128a77b73">HAL_VTIMER_TimeoutCallback</a>();</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  }</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  WAKEUP-&gt;WAKEUP_BLE_IRQ_STATUS |= 1;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  status = WAKEUP-&gt;WAKEUP_BLE_IRQ_STATUS;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;}</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div>
<div class="line"><a name="l00545"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#ga340e1a2a0814d3cd0e4c424128a77b73">  545</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga340e1a2a0814d3cd0e4c424128a77b73">HAL_VTIMER_TimeoutCallback</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;{</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keyword">volatile</span> uint32_t status;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  hostIsRadioPending = 0;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="comment">/* Disable host timer */</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  TIMER_DISABLE_CM0_TIMER;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  INCREMENT_EXPIRE_COUNT_ISR;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="comment">/* Clear the interrupt */</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  WAKEUP-&gt;WAKEUP_CM0_IRQ_STATUS |= 1;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  status = WAKEUP-&gt;WAKEUP_CM0_IRQ_STATUS;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;}</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00563"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#ga2eefabbf7064ede9a8b826e8e38ddddf">  563</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga2eefabbf7064ede9a8b826e8e38ddddf">HAL_VTIMER_EndOfRadioActivityIsr</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;{</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a04de9dbee80ed37f59e20974de549ad6">intTxRx_to_be_served</a> = FALSE;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;}</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#ga57a0ed22841524238fa069e90858a3d5">  572</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga57a0ed22841524238fa069e90858a3d5">HAL_VTIMER_RadioTimerIsr</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;{</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordflow">if</span> (!(TIMER_GET_TIMER1_STATUS || TIMER_GET_TIMER2_STATUS))</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  {</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    _check_host_activity();</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#ga13cf06d3aebe23c7d0bf4606c2e2ca5f">  590</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga13cf06d3aebe23c7d0bf4606c2e2ca5f">HAL_VTIMER_StartTimerSysTime</a>(<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *timerHandle, uint64_t time)</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;{</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  uint8_t retVal;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  retVal = _start_timer(timerHandle, time);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  _virtualTimeBaseEnable(ENABLE);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="keywordflow">return</span> retVal;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;}</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div>
<div class="line"><a name="l00605"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#gab70a77f7eaa518eb1105b68a6a2542f2">  605</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#gab70a77f7eaa518eb1105b68a6a2542f2">HAL_VTIMER_StartTimerMs</a>(<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *timerHandle, uint32_t msRelTimeout)</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;{</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  uint64_t temp = msRelTimeout;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  uint8_t retVal;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  retVal = _start_timer(timerHandle, TIMER_GetCurrentSysTime() + (temp*TIMER_SYSTICK_PER_10MS)/10);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  _virtualTimeBaseEnable(ENABLE);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="keywordflow">return</span> retVal;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;}</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div>
<div class="line"><a name="l00624"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#gaf748b6465023dc93f8b0e59c04bbbc5c">  624</a></span>&#160;uint8_t <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#gaf748b6465023dc93f8b0e59c04bbbc5c">HAL_VTIMER_SetRadioTimerValue</a>(uint32_t time, uint8_t event_type, uint8_t cal_req)</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;{</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  uint8_t retVal = 0;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  uint64_t current_time;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a3c962931bc008b457e00a49273bd8ecb">event_type</a> = event_type;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a0072edb361743a559932f59cf591fe26">cal_req</a> = cal_req;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a> = calibrationData.last_calibration_time + (uint32_t)(time - (uint32_t)calibrationData.last_calibration_time);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">active</a> = FALSE;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a04de9dbee80ed37f59e20974de549ad6">intTxRx_to_be_served</a> = FALSE;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a22b9bda680e9f825fe56a0dd54ab3ef3">pending</a> = TRUE;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  current_time = TIMER_GetCurrentSysTime();</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="keywordflow">if</span> (HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a> == NULL) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    _check_radio_activity(&amp;radioTimer, &amp;retVal);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">if</span>(HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a9528c6497645126b8293fffd4b16fc8c">expiryTime</a> &lt; current_time ||</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;       ((radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a> &lt; (HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a9528c6497645126b8293fffd4b16fc8c">expiryTime</a> + hostMargin)) &amp;&amp; HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a29166f80ce4b5c58d419312f78bacb96">active</a>) || !HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a29166f80ce4b5c58d419312f78bacb96">active</a>)</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    {</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="comment">/* Program the radio timer */</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      _check_radio_activity(&amp;radioTimer, &amp;retVal);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      <span class="keywordflow">if</span>((radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a> &gt;= HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a9528c6497645126b8293fffd4b16fc8c">expiryTime</a>) &amp;&amp; HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a29166f80ce4b5c58d419312f78bacb96">active</a>)</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="comment">/*The radio operation is before or too close the host timeout*/</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        hostIsRadioPending = 1;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    }</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="comment">/* If radio timer is not programmed, an emulated host timer is already programmed.</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">      Make sure radio errors are disabled.</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">      This call is not needed if radio errors are not enabled by the BLE stack. */</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      _set_controller_as_host();</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  }</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  _check_radio_activity(&amp;radioTimer, &amp;retVal);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  </div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  _virtualTimeBaseEnable(ENABLE);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="keywordflow">return</span> retVal;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;}</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div>
<div class="line"><a name="l00675"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#gad8a3825461350990147c342fb0eab229">  675</a></span>&#160;uint64_t <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#gad8a3825461350990147c342fb0eab229">HAL_VTIMER_GetAnchorPoint</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;{</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordflow">return</span> TIMER_GetAnchorPoint();</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;}</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00685"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#ga44f91bce3a1a14dd44b71bdacec9ad2d">  685</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga44f91bce3a1a14dd44b71bdacec9ad2d">HAL_VTIMER_StopTimer</a>(<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *timerHandle)</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;{</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *rootNode = _remove_timer_in_queue(HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>, timerHandle);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  uint8_t expired = 0;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a29166f80ce4b5c58d419312f78bacb96">active</a>=FALSE;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="keywordflow">if</span> (HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a> != rootNode) {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a> = _update_user_timeout(rootNode, &amp;expired);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">if</span> (expired) {</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="comment">/* A new root timer is already expired, mimic timer expire */</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      INCREMENT_EXPIRE_COUNT;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;     HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a> = rootNode;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;}       </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div>
<div class="line"><a name="l00707"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#ga39d7a7564e22cdf700bf103576a84201">  707</a></span>&#160;uint64_t <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga39d7a7564e22cdf700bf103576a84201">HAL_VTIMER_GetCurrentSysTime</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;{</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="keywordflow">return</span> TIMER_GetCurrentSysTime();</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;}</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div>
<div class="line"><a name="l00718"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#ga39958eaf296f761a1c8d5b7cc00193b7">  718</a></span>&#160;uint64_t <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga39958eaf296f761a1c8d5b7cc00193b7">HAL_VTIMER_AddSysTimeMs</a>(uint64_t sysTime, int32_t msTime)</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;{</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  int32_t sysTick = (msTime * TIMER_SYSTICK_PER_10MS)/10;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keywordflow">return</span> (sysTime+sysTick);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;}</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#ga4ea3ab9a8dba016b923fed5656982c87">  731</a></span>&#160;int64_t <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga4ea3ab9a8dba016b923fed5656982c87">HAL_VTIMER_DiffSysTimeMs</a>(uint64_t sysTime1, uint64_t sysTime2)</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;{</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="keywordflow">return</span> ((sysTime1-sysTime2)*10)&gt;&gt;12;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;}</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div>
<div class="line"><a name="l00741"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#gaf7fc50118cfd58188e041b074a91e43d">  741</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#gaf7fc50118cfd58188e041b074a91e43d">HAL_VTIMER_ExpiryTime</a>(<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *timerHandle, uint64_t *sysTime)</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;{</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  *sysTime = timerHandle-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a9528c6497645126b8293fffd4b16fc8c">expiryTime</a>;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;}</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div>
<div class="line"><a name="l00751"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#ga9cad075d6ec15937f981dc558823047e">  751</a></span>&#160;uint32_t <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga9cad075d6ec15937f981dc558823047e">HAL_VTIMER_GetPendingTimers</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;{</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *curr = HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  uint32_t counter = 0;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="keywordflow">while</span> (curr != NULL) {</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    counter++;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    curr = curr-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">next</a>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  }</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="keywordflow">return</span> counter;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;}</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div>
<div class="line"><a name="l00767"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#gaed9b6ad8c982914c2b804700241b7e0b">  767</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#gaed9b6ad8c982914c2b804700241b7e0b">HAL_VTIMER_Init</a>(<a class="code" href="struct_h_a_l___v_t_i_m_e_r___init_s.html">HAL_VTIMER_InitType</a> *HAL_TIMER_InitStruct)</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;{</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  TIMER_InitType TIMER_InitStruct;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  TIMER_Enable_CPU_WKUP();</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE </span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    WAKEUP-&gt;WAKEUP_BLE_IRQ_STATUS |= 1;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    WAKEUP-&gt;WAKEUP_BLE_IRQ_ENABLE |= 1;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    NVIC_EnableIRQ(BLE_WKUP_IRQn);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    hostMargin = MAX(HOST_MARGIN,HAL_TIMER_InitStruct-&gt;<a class="code" href="struct_h_a_l___v_t_i_m_e_r___init_s.html#a4a32333ed2c9c4a516b2fb3f13440cbe">XTAL_StartupTime</a>);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  </div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  NVIC_EnableIRQ(BLE_ERROR_IRQn);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  TIMER_InitStruct.TIMER_InitialCalibration = HAL_TIMER_InitStruct-&gt;<a class="code" href="struct_h_a_l___v_t_i_m_e_r___init_s.html#a5f7ad1f8f2182e44e8fac388a616f85d">EnableInitialCalibration</a>;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  TIMER_InitStruct.TIMER_PeriodicCalibration = (HAL_TIMER_InitStruct-&gt;<a class="code" href="struct_h_a_l___v_t_i_m_e_r___init_s.html#a2c3c45b28893c4fb086ec87527502fc4">PeriodicCalibrationInterval</a>!=0);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  TIMER_InitStruct.XTAL_StartupTime = HAL_TIMER_InitStruct-&gt;<a class="code" href="struct_h_a_l___v_t_i_m_e_r___init_s.html#a4a32333ed2c9c4a516b2fb3f13440cbe">XTAL_StartupTime</a>;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  TIMER_Init(&amp;TIMER_InitStruct);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  TIMER_GetCurrentCalibrationData(&amp;calibrationData); </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a> = NULL;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#ad191a5b8142d56344dd526de70c33eea">enableTimeBase</a> = TRUE;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a1ee031d20e170349064d749b04168241">wakeup_calibration</a> = (HAL_TIMER_InitStruct-&gt;<a class="code" href="struct_h_a_l___v_t_i_m_e_r___init_s.html#a2c3c45b28893c4fb086ec87527502fc4">PeriodicCalibrationInterval</a>!=0);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a985631f2067fdf6bcd40228e5634b2d0">stop_notimer_action</a> = FALSE;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">active</a> = FALSE;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a22b9bda680e9f825fe56a0dd54ab3ef3">pending</a> = FALSE;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a04de9dbee80ed37f59e20974de549ad6">intTxRx_to_be_served</a> = FALSE;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a> = 0;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a409e439f10c0b0a2d62eed495a10e62b">hs_startup_time</a> = HAL_TIMER_InitStruct-&gt;<a class="code" href="struct_h_a_l___v_t_i_m_e_r___init_s.html#a4a32333ed2c9c4a516b2fb3f13440cbe">XTAL_StartupTime</a>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a469e12352153c7f79bb360af025be558">expired_count</a>=0;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a6a6415f8e6d477e1f1a29b0157b91224">served_count</a>=0;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a56a5ec998fc953d22310ffc8ed5455ee">PeriodicCalibrationInterval</a> = (TIMER_SYSTICK_PER_10MS * HAL_TIMER_InitStruct-&gt;<a class="code" href="struct_h_a_l___v_t_i_m_e_r___init_s.html#a2c3c45b28893c4fb086ec87527502fc4">PeriodicCalibrationInterval</a>)/10;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a8be087d5097e059cf2c64172d741c76e">calibration_in_progress</a> = FALSE;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="keywordflow">if</span> (HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a56a5ec998fc953d22310ffc8ed5455ee">PeriodicCalibrationInterval</a> == 0)</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a56a5ec998fc953d22310ffc8ed5455ee">PeriodicCalibrationInterval</a> = TIMER_MachineTimeToSysTime(TIMER_MAX_VALUE-TIMER_WRAPPING_MARGIN);</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a56a5ec998fc953d22310ffc8ed5455ee">PeriodicCalibrationInterval</a> = MIN(HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a56a5ec998fc953d22310ffc8ed5455ee">PeriodicCalibrationInterval</a>,</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                                                       TIMER_MachineTimeToSysTime(TIMER_MAX_VALUE-TIMER_WRAPPING_MARGIN));</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  calibrationTimer.<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a6b592b6a432c4e22fafc886492dcb215">callback</a> = calibration_callback;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  calibrationTimer.<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a20c14eaf8526f4114cc71a5e29d338cd">userData</a> = NULL;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  _start_timer(&amp;calibrationTimer, TIMER_GetCurrentSysTime() + HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a56a5ec998fc953d22310ffc8ed5455ee">PeriodicCalibrationInterval</a>);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  TIMER_SaveCalibrationInterval(HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a56a5ec998fc953d22310ffc8ed5455ee">PeriodicCalibrationInterval</a>);  </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;}</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div>
<div class="line"><a name="l00815"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#ga3e0fa8ea7b066acf8f2299d2cb73ae19">  815</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga3e0fa8ea7b066acf8f2299d2cb73ae19">HAL_VTIMER_Tick</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;{</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  uint8_t expired = 0;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  ATOMIC_SECTION_BEGIN();</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="keywordflow">if</span>(radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">active</a>){</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">if</span>(radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a> &lt; TIMER_GetCurrentSysTime()){</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">active</a> = FALSE;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  ATOMIC_SECTION_END();</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="comment">/* Check for expired timers */</span>  </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="keywordflow">while</span> (DIFF8(HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a469e12352153c7f79bb360af025be558">expired_count</a>,HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a6a6415f8e6d477e1f1a29b0157b91224">served_count</a>)) {</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *expiredList, *curr;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    uint8_t to_be_served = DIFF8(HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a469e12352153c7f79bb360af025be558">expired_count</a>,HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a6a6415f8e6d477e1f1a29b0157b91224">served_count</a>);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a> = _check_callbacks(HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>, &amp;expiredList);</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    </div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="comment">/* Call all the user callbacks */</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    curr=expiredList;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordflow">while</span> (curr != NULL) {</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      <span class="comment">/* Save next pointer, in case callback start the timer again */</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleType</a> *next = curr-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">next</a>;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      curr-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a29166f80ce4b5c58d419312f78bacb96">active</a> = FALSE;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      <span class="keywordflow">if</span> (curr-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a6b592b6a432c4e22fafc886492dcb215">callback</a>)</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        curr-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a6b592b6a432c4e22fafc886492dcb215">callback</a>(curr); <span class="comment">/* we are sure a callback is set?*/</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      curr = next;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    }</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    </div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a> = _update_user_timeout(HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>, &amp;expired);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keywordflow">if</span> (expired == 1) {</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      <span class="comment">/* A new root timer is already expired, mimic timer expire */</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      INCREMENT_EXPIRE_COUNT;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a6a6415f8e6d477e1f1a29b0157b91224">served_count</a> += to_be_served;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  }</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="comment">/* Check for periodic calibration */</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="keywordflow">if</span> (HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a8be087d5097e059cf2c64172d741c76e">calibration_in_progress</a>) {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;     <span class="keywordflow">if</span> (TIMER_IsCalibrationRunning() == FALSE) {</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      <span class="comment">/* Calibration is completed */</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a8be087d5097e059cf2c64172d741c76e">calibration_in_progress</a> = FALSE;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="keywordflow">if</span> ((HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a1ee031d20e170349064d749b04168241">wakeup_calibration</a> == FALSE) &amp;&amp; HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a985631f2067fdf6bcd40228e5634b2d0">stop_notimer_action</a>) {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a985631f2067fdf6bcd40228e5634b2d0">stop_notimer_action</a> = FALSE;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <span class="comment">/* Collect calibration data */</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        TIMER_UpdateCalibrationData();</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        TIMER_GetCurrentCalibrationData(&amp;calibrationData);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      }</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="preprocessor">#if HOST_WAKEUP_FIX_ENABLE</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordflow">if</span>(waitCal){</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        waitCal = 0;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a22b9bda680e9f825fe56a0dd54ab3ef3">pending</a> = TRUE;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        _check_radio_activity(&amp;radioTimer,&amp;expired);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a> = _update_user_timeout(HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>, &amp;expired);</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      }</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      _check_radio_activity(&amp;radioTimer,&amp;expired);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga44f91bce3a1a14dd44b71bdacec9ad2d">HAL_VTIMER_StopTimer</a>(&amp;calibrationTimer);</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <span class="comment">/* Schedule next calibration event */</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      _start_timer(&amp;calibrationTimer, TIMER_GetCurrentSysTime() + HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a56a5ec998fc953d22310ffc8ed5455ee">PeriodicCalibrationInterval</a>);</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    }           </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  }</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="comment">/* if there is a periodic calibration, start it in advance during the active phase */</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordflow">if</span>(calibrationData.periodic_calibration){</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      <span class="keywordflow">if</span>( TIMER_GetCurrentSysTime() &gt; (calibrationData.last_calibration_time + TIMER_SYSTICK_PER_FIVE_SECONDS))</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      {</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        calibration_callback(&amp;calibrationTimer);</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      }</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    }</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;}</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#ga8721ff9b8916b48453993436c2e1a484">  896</a></span>&#160;<a class="code" href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcf">PowerSaveLevels</a> <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#ga8721ff9b8916b48453993436c2e1a484">HAL_VTIMER_PowerSaveLevelCheck</a>(<a class="code" href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcf">PowerSaveLevels</a> level)</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;{</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  uint32_t nextRadioActivity;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  uint8_t timerState;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group___v_t_i_m_e_r___exported___functions.html#gabe0ad9f4b460d52199b37a7871ff7537">HAL_VTIMER_SleepCheck</a>() == FALSE)</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  {</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcfaeafc7333ffe256c40f870bdff21c37a6">POWER_SAVE_LEVEL_RUNNING</a>;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  }</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  timerState = TIMER_GetRadioTimerValue(&amp;nextRadioActivity);</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="comment">/*Timer1 and wakeup timer are programmed only through </span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment">  the timer module*/</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="keywordflow">if</span>(((radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">active</a> || radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a22b9bda680e9f825fe56a0dd54ab3ef3">pending</a>)  &amp;&amp; !(timerState == TIMER1_BUSY)) || radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a04de9dbee80ed37f59e20974de549ad6">intTxRx_to_be_served</a>)</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keywordflow">if</span>(radioTimer.<a class="code" href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">expiryTime</a> &lt; (TIMER_GetCurrentSysTime() + \</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                                __TIMER_GetSysRfSetupTime() + \</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                                HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a409e439f10c0b0a2d62eed495a10e62b">hs_startup_time</a> + \</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                                LOW_POWER_THR))</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    {</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcfa312209c92137a192fe7401659ce5b724">POWER_SAVE_LEVEL_CPU_HALT</a>;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    level = <a class="code" href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcfac1bf6cc2a949d3871bf162e52c94a61d">POWER_SAVE_LEVEL_STOP_WITH_TIMER</a>;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  }</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="keywordflow">if</span> ((timerState == TIMER2_BUSY) || (timerState == TIMER1_BUSY))</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    {</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcfa312209c92137a192fe7401659ce5b724">POWER_SAVE_LEVEL_CPU_HALT</a>;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    }</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  }</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="keywordflow">if</span>(HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a> != NULL &amp;&amp; HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a29166f80ce4b5c58d419312f78bacb96">active</a>)</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">if</span>(HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a9528c6497645126b8293fffd4b16fc8c">expiryTime</a> &lt; (TIMER_GetCurrentSysTime() + LOW_POWER_THR + HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a409e439f10c0b0a2d62eed495a10e62b">hs_startup_time</a>))</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    {</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcfa312209c92137a192fe7401659ce5b724">POWER_SAVE_LEVEL_CPU_HALT</a>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    }</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    </div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordflow">if</span>(level == <a class="code" href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcfa80e18846af13b0366b30c4467fede427">POWER_SAVE_LEVEL_STOP_NOTIMER</a>)</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      <span class="keywordflow">if</span>((HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a>-&gt;<a class="code" href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">next</a> == NULL) &amp;&amp; (HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">rootNode</a> == &amp;calibrationTimer))</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a985631f2067fdf6bcd40228e5634b2d0">stop_notimer_action</a> = TRUE;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        _virtualTimeBaseEnable(DISABLE);</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        TIMER_DISABLE_CM0_TIMER;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcfa80e18846af13b0366b30c4467fede427">POWER_SAVE_LEVEL_STOP_NOTIMER</a>;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      }</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    }</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    level = <a class="code" href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcfac1bf6cc2a949d3871bf162e52c94a61d">POWER_SAVE_LEVEL_STOP_WITH_TIMER</a>;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  }</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keywordflow">return</span> level;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;}</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00956"></a><span class="lineno"><a class="line" href="group___v_t_i_m_e_r___exported___functions.html#gabe0ad9f4b460d52199b37a7871ff7537">  956</a></span>&#160;BOOL <a class="code" href="group___v_t_i_m_e_r___exported___functions.html#gabe0ad9f4b460d52199b37a7871ff7537">HAL_VTIMER_SleepCheck</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;{</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <span class="keywordflow">return</span> ((HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a469e12352153c7f79bb360af025be558">expired_count</a> == HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a6a6415f8e6d477e1f1a29b0157b91224">served_count</a>) &amp;&amp; (HAL_VTIMER_Context.<a class="code" href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a8be087d5097e059cf2c64172d741c76e">calibration_in_progress</a> == FALSE));</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;}</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="comment">/******************* (C) COPYRIGHT 2020 STMicroelectronics *****END OF FILE****/</span></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___context_s_html"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___context_s.html">HAL_VTIMER_ContextS</a></div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00126">rf_driver_hal_vtimer.c:126</a></div></div>
<div class="ttc" id="rf__driver__hal__power__manager_8h_html_add9f92e98a807cfb0e333c872ef9efcfa80e18846af13b0366b30c4467fede427"><div class="ttname"><a href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcfa80e18846af13b0366b30c4467fede427">POWER_SAVE_LEVEL_STOP_NOTIMER</a></div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__power__manager_8h_source.html#l00048">rf_driver_hal_power_manager.h:48</a></div></div>
<div class="ttc" id="rf__driver__hal__power__manager_8h_html_add9f92e98a807cfb0e333c872ef9efcfa312209c92137a192fe7401659ce5b724"><div class="ttname"><a href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcfa312209c92137a192fe7401659ce5b724">POWER_SAVE_LEVEL_CPU_HALT</a></div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__power__manager_8h_source.html#l00046">rf_driver_hal_power_manager.h:46</a></div></div>
<div class="ttc" id="struct_v_t_i_m_e_r___handle_type_s_html_a29166f80ce4b5c58d419312f78bacb96"><div class="ttname"><a href="struct_v_t_i_m_e_r___handle_type_s.html#a29166f80ce4b5c58d419312f78bacb96">VTIMER_HandleTypeS::active</a></div><div class="ttdeci">BOOL active</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8h_source.html#l00053">rf_driver_hal_vtimer.h:53</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_gab70a77f7eaa518eb1105b68a6a2542f2"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#gab70a77f7eaa518eb1105b68a6a2542f2">HAL_VTIMER_StartTimerMs</a></div><div class="ttdeci">int HAL_VTIMER_StartTimerMs(VTIMER_HandleType *timerHandle, uint32_t msRelTimeout)</div><div class="ttdoc">Starts a one-shot virtual timer for the given relative timeout value expressed in ms...</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00605">rf_driver_hal_vtimer.c:605</a></div></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___init_s_html"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___init_s.html">HAL_VTIMER_InitS</a></div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8h_source.html#l00058">rf_driver_hal_vtimer.h:58</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_ga57a0ed22841524238fa069e90858a3d5"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#ga57a0ed22841524238fa069e90858a3d5">HAL_VTIMER_RadioTimerIsr</a></div><div class="ttdeci">void HAL_VTIMER_RadioTimerIsr(void)</div><div class="ttdoc">Radio activity finished. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00572">rf_driver_hal_vtimer.c:572</a></div></div>
<div class="ttc" id="struct_v_t_i_m_e_r___radio_handle_type_s_html_a3c962931bc008b457e00a49273bd8ecb"><div class="ttname"><a href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a3c962931bc008b457e00a49273bd8ecb">VTIMER_RadioHandleTypeS::event_type</a></div><div class="ttdeci">BOOL event_type</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00144">rf_driver_hal_vtimer.c:144</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___types_html_gga506797a0f088c9be2b06772066d5fcdaa4d845c6aaa87e5237d2fa85b2ad1317e"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___types.html#gga506797a0f088c9be2b06772066d5fcdaa4d845c6aaa87e5237d2fa85b2ad1317e">RADIO_TIMER_PENDING</a></div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8h_source.html#l00046">rf_driver_hal_vtimer.h:46</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_ga2eefabbf7064ede9a8b826e8e38ddddf"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#ga2eefabbf7064ede9a8b826e8e38ddddf">HAL_VTIMER_EndOfRadioActivityIsr</a></div><div class="ttdeci">void HAL_VTIMER_EndOfRadioActivityIsr(void)</div><div class="ttdoc">Timer State machine semaphore to signal the radio activity finished. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00563">rf_driver_hal_vtimer.c:563</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_ga9cad075d6ec15937f981dc558823047e"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#ga9cad075d6ec15937f981dc558823047e">HAL_VTIMER_GetPendingTimers</a></div><div class="ttdeci">uint32_t HAL_VTIMER_GetPendingTimers(void)</div><div class="ttdoc">Returns the number of timers in the queue. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00751">rf_driver_hal_vtimer.c:751</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___types_html_ga506797a0f088c9be2b06772066d5fcda"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___types.html#ga506797a0f088c9be2b06772066d5fcda">TimerStatus</a></div><div class="ttdeci">TimerStatus</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8h_source.html#l00044">rf_driver_hal_vtimer.h:44</a></div></div>
<div class="ttc" id="struct_v_t_i_m_e_r___radio_handle_type_s_html"><div class="ttname"><a href="struct_v_t_i_m_e_r___radio_handle_type_s.html">VTIMER_RadioHandleTypeS</a></div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00138">rf_driver_hal_vtimer.c:138</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_ga0965cae5f5c6c3509fbfedc0f97622ff"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#ga0965cae5f5c6c3509fbfedc0f97622ff">HAL_VTIMER_GetRadioTimerValue</a></div><div class="ttdeci">TimerStatus HAL_VTIMER_GetRadioTimerValue(uint64_t *time)</div><div class="ttdoc">Return the status of the radio timer. The timeout of the last radio timer activity taken into account...</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00457">rf_driver_hal_vtimer.c:457</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_gaef9d6a69a3861fdcfdfe66cbda2c8814"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#gaef9d6a69a3861fdcfdfe66cbda2c8814">HAL_VTIMER_StopRadioTimer2</a></div><div class="ttdeci">void HAL_VTIMER_StopRadioTimer2(void)</div><div class="ttdoc">Disable Timer2. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00512">rf_driver_hal_vtimer.c:512</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_ga8721ff9b8916b48453993436c2e1a484"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#ga8721ff9b8916b48453993436c2e1a484">HAL_VTIMER_PowerSaveLevelCheck</a></div><div class="ttdeci">PowerSaveLevels HAL_VTIMER_PowerSaveLevelCheck(PowerSaveLevels level)</div><div class="ttdoc">Returns the admitted sleep mode according to the next timer activity. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00896">rf_driver_hal_vtimer.c:896</a></div></div>
<div class="ttc" id="struct_v_t_i_m_e_r___handle_type_s_html"><div class="ttname"><a href="struct_v_t_i_m_e_r___handle_type_s.html">VTIMER_HandleTypeS</a></div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8h_source.html#l00050">rf_driver_hal_vtimer.h:50</a></div></div>
<div class="ttc" id="struct_v_t_i_m_e_r___handle_type_s_html_a6b592b6a432c4e22fafc886492dcb215"><div class="ttname"><a href="struct_v_t_i_m_e_r___handle_type_s.html#a6b592b6a432c4e22fafc886492dcb215">VTIMER_HandleTypeS::callback</a></div><div class="ttdeci">VTIMER_CallbackType callback</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8h_source.html#l00052">rf_driver_hal_vtimer.h:52</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_gaf7fc50118cfd58188e041b074a91e43d"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#gaf7fc50118cfd58188e041b074a91e43d">HAL_VTIMER_ExpiryTime</a></div><div class="ttdeci">int HAL_VTIMER_ExpiryTime(VTIMER_HandleType *timerHandle, uint64_t *sysTime)</div><div class="ttdoc">Returns the absolute expiry time of a running timer expressed in internal time units. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00741">rf_driver_hal_vtimer.c:741</a></div></div>
<div class="ttc" id="struct_v_t_i_m_e_r___radio_handle_type_s_html_ae78ee1e29e270240b0cdce74b83e9a75"><div class="ttname"><a href="struct_v_t_i_m_e_r___radio_handle_type_s.html#ae78ee1e29e270240b0cdce74b83e9a75">VTIMER_RadioHandleTypeS::active</a></div><div class="ttdeci">BOOL active</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00141">rf_driver_hal_vtimer.c:141</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_gaf748b6465023dc93f8b0e59c04bbbc5c"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#gaf748b6465023dc93f8b0e59c04bbbc5c">HAL_VTIMER_SetRadioTimerValue</a></div><div class="ttdeci">uint8_t HAL_VTIMER_SetRadioTimerValue(uint32_t time, uint8_t event_type, uint8_t cal_req)</div><div class="ttdoc">Schedules a radio activity for the given absolute timeout value expressed in STU. If the calibration ...</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00624">rf_driver_hal_vtimer.c:624</a></div></div>
<div class="ttc" id="struct_v_t_i_m_e_r___radio_handle_type_s_html_a8be9e072b9f40552147d419f182a0397"><div class="ttname"><a href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a8be9e072b9f40552147d419f182a0397">VTIMER_RadioHandleTypeS::expiryTime</a></div><div class="ttdeci">uint64_t expiryTime</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00139">rf_driver_hal_vtimer.c:139</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_ga4ea3ab9a8dba016b923fed5656982c87"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#ga4ea3ab9a8dba016b923fed5656982c87">HAL_VTIMER_DiffSysTimeMs</a></div><div class="ttdeci">int64_t HAL_VTIMER_DiffSysTimeMs(uint64_t sysTime1, uint64_t sysTime2)</div><div class="ttdoc">Returns the difference between two absolute times: sysTime1-sysTime2. The resulting value is expresse...</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00731">rf_driver_hal_vtimer.c:731</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_ga39958eaf296f761a1c8d5b7cc00193b7"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#ga39958eaf296f761a1c8d5b7cc00193b7">HAL_VTIMER_AddSysTimeMs</a></div><div class="ttdeci">uint64_t HAL_VTIMER_AddSysTimeMs(uint64_t sysTime, int32_t msTime)</div><div class="ttdoc">This function returns the sum of an absolute time and a signed relative time. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00718">rf_driver_hal_vtimer.c:718</a></div></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___context_s_html_ad191a5b8142d56344dd526de70c33eea"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___context_s.html#ad191a5b8142d56344dd526de70c33eea">HAL_VTIMER_ContextS::enableTimeBase</a></div><div class="ttdeci">BOOL enableTimeBase</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00130">rf_driver_hal_vtimer.c:130</a></div></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___init_s_html_a2c3c45b28893c4fb086ec87527502fc4"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___init_s.html#a2c3c45b28893c4fb086ec87527502fc4">HAL_VTIMER_InitS::PeriodicCalibrationInterval</a></div><div class="ttdeci">uint32_t PeriodicCalibrationInterval</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8h_source.html#l00065">rf_driver_hal_vtimer.h:65</a></div></div>
<div class="ttc" id="rf__driver__hal__power__manager_8h_html_add9f92e98a807cfb0e333c872ef9efcfaeafc7333ffe256c40f870bdff21c37a6"><div class="ttname"><a href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcfaeafc7333ffe256c40f870bdff21c37a6">POWER_SAVE_LEVEL_RUNNING</a></div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__power__manager_8h_source.html#l00045">rf_driver_hal_power_manager.h:45</a></div></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___context_s_html_a6a6415f8e6d477e1f1a29b0157b91224"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a6a6415f8e6d477e1f1a29b0157b91224">HAL_VTIMER_ContextS::served_count</a></div><div class="ttdeci">uint8_t served_count</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00133">rf_driver_hal_vtimer.c:133</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_ga3e0fa8ea7b066acf8f2299d2cb73ae19"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#ga3e0fa8ea7b066acf8f2299d2cb73ae19">HAL_VTIMER_Tick</a></div><div class="ttdeci">void HAL_VTIMER_Tick(void)</div><div class="ttdoc">Timer module state machine. Check and schedule the calibration. Check expired timers and execute user...</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00815">rf_driver_hal_vtimer.c:815</a></div></div>
<div class="ttc" id="struct_v_t_i_m_e_r___handle_type_s_html_a51953ab27ed5da5fc0242722b4537bd6"><div class="ttname"><a href="struct_v_t_i_m_e_r___handle_type_s.html#a51953ab27ed5da5fc0242722b4537bd6">VTIMER_HandleTypeS::next</a></div><div class="ttdeci">struct VTIMER_HandleTypeS * next</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8h_source.html#l00054">rf_driver_hal_vtimer.h:54</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_gae1d46c043469b27286d3583cffa1e894"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#gae1d46c043469b27286d3583cffa1e894">HAL_VTIMER_ClearRadioTimerValue</a></div><div class="ttdeci">uint8_t HAL_VTIMER_ClearRadioTimerValue(void)</div><div class="ttdoc">Clear the last radio activity scheduled disabling the radio timers too. Furthermore, it returns if the timeout is too close with respect the current time and the radio activity might not be cleared in time. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00474">rf_driver_hal_vtimer.c:474</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_gad8a3825461350990147c342fb0eab229"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#gad8a3825461350990147c342fb0eab229">HAL_VTIMER_GetAnchorPoint</a></div><div class="ttdeci">uint64_t HAL_VTIMER_GetAnchorPoint(void)</div><div class="ttdoc">Get the last anchorPoint in system time unit. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00675">rf_driver_hal_vtimer.c:675</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_ga39d7a7564e22cdf700bf103576a84201"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#ga39d7a7564e22cdf700bf103576a84201">HAL_VTIMER_GetCurrentSysTime</a></div><div class="ttdeci">uint64_t HAL_VTIMER_GetCurrentSysTime(void)</div><div class="ttdoc">This function returns the current reference time expressed in system time units. The returned value c...</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00707">rf_driver_hal_vtimer.c:707</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_gac1b0eae9d27248ee7a721ae32fc9b90c"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#gac1b0eae9d27248ee7a721ae32fc9b90c">HAL_VTIMER_WakeUpCallback</a></div><div class="ttdeci">void HAL_VTIMER_WakeUpCallback(void)</div><div class="ttdoc">If the wakeup timer triggers for a host wakeup, a pending radio activity is programmed. If the wakeup timer triggers for a radio activity, a pending virtual timer callback is executed. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00523">rf_driver_hal_vtimer.c:523</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_ga44f91bce3a1a14dd44b71bdacec9ad2d"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#ga44f91bce3a1a14dd44b71bdacec9ad2d">HAL_VTIMER_StopTimer</a></div><div class="ttdeci">void HAL_VTIMER_StopTimer(VTIMER_HandleType *timerHandle)</div><div class="ttdoc">Stops the one-shot virtual timer specified if found. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00685">rf_driver_hal_vtimer.c:685</a></div></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___context_s_html_a9564011d603c99c5b66d132e2b1454f4"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a9564011d603c99c5b66d132e2b1454f4">HAL_VTIMER_ContextS::rootNode</a></div><div class="ttdeci">VTIMER_HandleType * rootNode</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00129">rf_driver_hal_vtimer.c:129</a></div></div>
<div class="ttc" id="struct_v_t_i_m_e_r___radio_handle_type_s_html_a22b9bda680e9f825fe56a0dd54ab3ef3"><div class="ttname"><a href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a22b9bda680e9f825fe56a0dd54ab3ef3">VTIMER_RadioHandleTypeS::pending</a></div><div class="ttdeci">BOOL pending</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00142">rf_driver_hal_vtimer.c:142</a></div></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___init_s_html_a4a32333ed2c9c4a516b2fb3f13440cbe"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___init_s.html#a4a32333ed2c9c4a516b2fb3f13440cbe">HAL_VTIMER_InitS::XTAL_StartupTime</a></div><div class="ttdeci">uint16_t XTAL_StartupTime</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8h_source.html#l00059">rf_driver_hal_vtimer.h:59</a></div></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___init_s_html_a5f7ad1f8f2182e44e8fac388a616f85d"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___init_s.html#a5f7ad1f8f2182e44e8fac388a616f85d">HAL_VTIMER_InitS::EnableInitialCalibration</a></div><div class="ttdeci">BOOL EnableInitialCalibration</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8h_source.html#l00064">rf_driver_hal_vtimer.h:64</a></div></div>
<div class="ttc" id="rf__driver__hal__power__manager_8h_html_add9f92e98a807cfb0e333c872ef9efcfac1bf6cc2a949d3871bf162e52c94a61d"><div class="ttname"><a href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcfac1bf6cc2a949d3871bf162e52c94a61d">POWER_SAVE_LEVEL_STOP_WITH_TIMER</a></div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__power__manager_8h_source.html#l00047">rf_driver_hal_power_manager.h:47</a></div></div>
<div class="ttc" id="rf__driver__hal__vtimer_8h_html"><div class="ttname"><a href="rf__driver__hal__vtimer_8h.html">rf_driver_hal_vtimer.h</a></div><div class="ttdoc">Virtual timer and Radio timer high level APIs. </div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___types_html_gga506797a0f088c9be2b06772066d5fcdaafbaf726116172c486424f1a03eca59cc"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___types.html#gga506797a0f088c9be2b06772066d5fcdaafbaf726116172c486424f1a03eca59cc">RADIO_TIMER_OFF</a></div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8h_source.html#l00045">rf_driver_hal_vtimer.h:45</a></div></div>
<div class="ttc" id="struct_v_t_i_m_e_r___radio_handle_type_s_html_a04de9dbee80ed37f59e20974de549ad6"><div class="ttname"><a href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a04de9dbee80ed37f59e20974de549ad6">VTIMER_RadioHandleTypeS::intTxRx_to_be_served</a></div><div class="ttdeci">BOOL intTxRx_to_be_served</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00143">rf_driver_hal_vtimer.c:143</a></div></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___context_s_html_a409e439f10c0b0a2d62eed495a10e62b"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a409e439f10c0b0a2d62eed495a10e62b">HAL_VTIMER_ContextS::hs_startup_time</a></div><div class="ttdeci">uint32_t hs_startup_time</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00131">rf_driver_hal_vtimer.c:131</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_gabe0ad9f4b460d52199b37a7871ff7537"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#gabe0ad9f4b460d52199b37a7871ff7537">HAL_VTIMER_SleepCheck</a></div><div class="ttdeci">BOOL HAL_VTIMER_SleepCheck(void)</div><div class="ttdoc">Return the consensus of the Virtual timer management to go in sleep. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00956">rf_driver_hal_vtimer.c:956</a></div></div>
<div class="ttc" id="rf__driver__hal__power__manager_8h_html_add9f92e98a807cfb0e333c872ef9efcf"><div class="ttname"><a href="rf__driver__hal__power__manager_8h.html#add9f92e98a807cfb0e333c872ef9efcf">PowerSaveLevels</a></div><div class="ttdeci">PowerSaveLevels</div><div class="ttdoc">Enumerations for the possible microcontroller power save levels. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__power__manager_8h_source.html#l00044">rf_driver_hal_power_manager.h:44</a></div></div>
<div class="ttc" id="struct_v_t_i_m_e_r___handle_type_s_html_a9528c6497645126b8293fffd4b16fc8c"><div class="ttname"><a href="struct_v_t_i_m_e_r___handle_type_s.html#a9528c6497645126b8293fffd4b16fc8c">VTIMER_HandleTypeS::expiryTime</a></div><div class="ttdeci">uint64_t expiryTime</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8h_source.html#l00051">rf_driver_hal_vtimer.h:51</a></div></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___context_s_html_a1ee031d20e170349064d749b04168241"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a1ee031d20e170349064d749b04168241">HAL_VTIMER_ContextS::wakeup_calibration</a></div><div class="ttdeci">uint8_t wakeup_calibration</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00134">rf_driver_hal_vtimer.c:134</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___private___types_html_ga086868b0dd0e542f8167e889547c32e8"><div class="ttname"><a href="group___v_t_i_m_e_r___private___types.html#ga086868b0dd0e542f8167e889547c32e8">VTIMER_RadioHandleType</a></div><div class="ttdeci">struct VTIMER_RadioHandleTypeS VTIMER_RadioHandleType</div></div>
<div class="ttc" id="struct_v_t_i_m_e_r___handle_type_s_html_a20c14eaf8526f4114cc71a5e29d338cd"><div class="ttname"><a href="struct_v_t_i_m_e_r___handle_type_s.html#a20c14eaf8526f4114cc71a5e29d338cd">VTIMER_HandleTypeS::userData</a></div><div class="ttdeci">void * userData</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8h_source.html#l00055">rf_driver_hal_vtimer.h:55</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_ga13cf06d3aebe23c7d0bf4606c2e2ca5f"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#ga13cf06d3aebe23c7d0bf4606c2e2ca5f">HAL_VTIMER_StartTimerSysTime</a></div><div class="ttdeci">int HAL_VTIMER_StartTimerSysTime(VTIMER_HandleType *timerHandle, uint64_t time)</div><div class="ttdoc">Starts a one-shot virtual timer for the given absolute timeout value expressed in internal time units...</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00590">rf_driver_hal_vtimer.c:590</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_gaed9b6ad8c982914c2b804700241b7e0b"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#gaed9b6ad8c982914c2b804700241b7e0b">HAL_VTIMER_Init</a></div><div class="ttdeci">void HAL_VTIMER_Init(HAL_VTIMER_InitType *HAL_TIMER_InitStruct)</div><div class="ttdoc">Initialize the timer module. It must be placed in the initialization section of the application...</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00767">rf_driver_hal_vtimer.c:767</a></div></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___context_s_html_a469e12352153c7f79bb360af025be558"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a469e12352153c7f79bb360af025be558">HAL_VTIMER_ContextS::expired_count</a></div><div class="ttdeci">uint8_t expired_count</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00132">rf_driver_hal_vtimer.c:132</a></div></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___context_s_html_a985631f2067fdf6bcd40228e5634b2d0"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a985631f2067fdf6bcd40228e5634b2d0">HAL_VTIMER_ContextS::stop_notimer_action</a></div><div class="ttdeci">uint8_t stop_notimer_action</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00135">rf_driver_hal_vtimer.c:135</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___exported___functions_html_ga340e1a2a0814d3cd0e4c424128a77b73"><div class="ttname"><a href="group___v_t_i_m_e_r___exported___functions.html#ga340e1a2a0814d3cd0e4c424128a77b73">HAL_VTIMER_TimeoutCallback</a></div><div class="ttdeci">void HAL_VTIMER_TimeoutCallback(void)</div><div class="ttdoc">Virtual timer Timeout Callback. It signals that a host timeout occured. </div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00545">rf_driver_hal_vtimer.c:545</a></div></div>
<div class="ttc" id="struct_v_t_i_m_e_r___radio_handle_type_s_html_a0072edb361743a559932f59cf591fe26"><div class="ttname"><a href="struct_v_t_i_m_e_r___radio_handle_type_s.html#a0072edb361743a559932f59cf591fe26">VTIMER_RadioHandleTypeS::cal_req</a></div><div class="ttdeci">BOOL cal_req</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00140">rf_driver_hal_vtimer.c:140</a></div></div>
<div class="ttc" id="group___v_t_i_m_e_r___private___types_html_ga8fe244106cd42470148924a013d3de99"><div class="ttname"><a href="group___v_t_i_m_e_r___private___types.html#ga8fe244106cd42470148924a013d3de99">HAL_VTIMER_ContextType</a></div><div class="ttdeci">struct HAL_VTIMER_ContextS HAL_VTIMER_ContextType</div></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___context_s_html_a8be087d5097e059cf2c64172d741c76e"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a8be087d5097e059cf2c64172d741c76e">HAL_VTIMER_ContextS::calibration_in_progress</a></div><div class="ttdeci">BOOL calibration_in_progress</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00128">rf_driver_hal_vtimer.c:128</a></div></div>
<div class="ttc" id="struct_h_a_l___v_t_i_m_e_r___context_s_html_a56a5ec998fc953d22310ffc8ed5455ee"><div class="ttname"><a href="struct_h_a_l___v_t_i_m_e_r___context_s.html#a56a5ec998fc953d22310ffc8ed5455ee">HAL_VTIMER_ContextS::PeriodicCalibrationInterval</a></div><div class="ttdeci">uint32_t PeriodicCalibrationInterval</div><div class="ttdef"><b>Definition:</b> <a href="rf__driver__hal__vtimer_8c_source.html#l00127">rf_driver_hal_vtimer.c:127</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright &copy; 2022 by STMicrolectronics. All rights reserved.<br>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
